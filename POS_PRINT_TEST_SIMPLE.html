<!DOCTYPE html>
<html>
<head>
    <title>POS Print Test - Simple</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 15px 30px; margin: 10px; font-size: 18px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>üñ®Ô∏è POS Print Test - Simple</h1>
    
    <p>This test simulates exactly what the POS system does when printing a receipt.</p>
    
    <button onclick="testPrint()" style="background: #4CAF50; color: white; border: none; border-radius: 5px;">
        üñ®Ô∏è Test Print Receipt
    </button>
    
    <div id="result" style="margin-top: 20px; padding: 15px; border: 1px solid #ccc; min-height: 50px;">
        Click the button above to test printing...
    </div>

    <script>
        async function testPrint() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="info">üîÑ Testing print...</div>';
            
            // Simulate exact POS receipt data
            const receiptData = {
                transaction_id: 'POS_TEST_' + Date.now(),
                cashier_name: 'Test Cashier',
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString(),
                items: [
                    {
                        product_name: 'Test Product 1',
                        quantity: 2,
                        price: 25.00,
                        total: 50.00
                    },
                    {
                        product_name: 'Test Product 2',
                        quantity: 1,
                        price: 30.00,
                        total: 30.00
                    }
                ],
                subtotal: 80.00,
                tax: 0.00,
                total: 80.00,
                payment_type: 'cash',
                reference_number: 'REF_' + Date.now(),
                change: 20.00
            };
            
            try {
                console.log('üì§ Sending receipt data:', receiptData);
                
                const response = await fetch('http://localhost/caps2e2/Api/print-receipt-fixed-width.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(receiptData)
                });

                console.log('üì• Response status:', response.status, response.ok);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('‚ùå HTTP Error:', response.status, errorText);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('üìã Print result:', result);
                
                if (result.success) {
                    resultDiv.innerHTML = '<div class="success">‚úÖ Receipt printed successfully!<br>Check your POS-58 printer.</div>';
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ùå Print failed: ' + result.message + '</div>';
                }
                
            } catch (error) {
                console.error('‚ùå Print error:', error);
                resultDiv.innerHTML = '<div class="error">‚ùå Error: ' + error.message + '</div>';
            }
        }
    </script>
</body>
</html>
