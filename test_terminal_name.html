<!DOCTYPE html>
<html>
<head>
    <title>Test Terminal Name</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; }
        select { padding: 5px 10px; font-size: 16px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; background: #f9f9f9; }
    </style>
</head>
<body>
    <h1>üñ•Ô∏è Terminal Name Test</h1>
    
    <div>
        <label>Select Terminal:</label>
        <select id="terminalSelect" onchange="updateTerminal()">
            <option value="Convenience POS">Convenience POS</option>
            <option value="Pharmacy POS">Pharmacy POS</option>
            <option value="Inventory Terminal">Inventory Terminal</option>
        </select>
    </div>
    
    <button onclick="testPrintWithTerminal()">üñ®Ô∏è Test Print with Selected Terminal</button>
    
    <div id="result" class="result">
        Select a terminal and click "Test Print" to see what terminal name is sent to the receipt.
    </div>

    <script>
        function updateTerminal() {
            const selected = document.getElementById('terminalSelect').value;
            console.log('Selected terminal:', selected);
            document.getElementById('result').innerHTML = `Selected terminal: <strong>${selected}</strong>`;
        }
        
        async function testPrintWithTerminal() {
            const terminalName = document.getElementById('terminalSelect').value;
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div>üîÑ Testing print with terminal: <strong>' + terminalName + '</strong>...</div>';
            
            // Simulate exact POS data with selected terminal
            const receiptData = {
                transaction_id: 'TEST_' + Date.now(),
                cashier_name: 'Test Cashier',
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString(),
                terminalName: terminalName, // This is the key field
                items: [
                    {
                        product_name: 'Test Product',
                        quantity: 1,
                        price: 50.00,
                        total: 50.00
                    }
                ],
                subtotal: 50.00,
                tax: 0.00,
                total: 50.00,
                payment_type: 'cash',
                reference_number: 'REF_' + Date.now()
            };
            
            try {
                console.log('üì§ Sending receipt data with terminal:', terminalName, receiptData);
                
                const response = await fetch('http://localhost/caps2e2/Api/print-receipt-fixed-width.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(receiptData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('üìã Print result:', result);
                
                if (result.success) {
                    resultDiv.innerHTML = `<div style="color: green;">‚úÖ Receipt printed successfully!<br>Terminal sent: <strong>${terminalName}</strong><br>Check your POS-58 printer to see if the correct terminal appears on the receipt.</div>`;
                } else {
                    resultDiv.innerHTML = `<div style="color: red;">‚ùå Print failed: ${result.message}</div>`;
                }
                
            } catch (error) {
                console.error('‚ùå Print error:', error);
                resultDiv.innerHTML = `<div style="color: red;">‚ùå Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
